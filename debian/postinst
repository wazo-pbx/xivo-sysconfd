#!/bin/sh

set -e

case "$1" in
	configure)
		# cleanup pf-xivo-sysconfd backup directory
		old_sysconfd_directory="/var/backups/pf-xivo-sysconfd"
		new_sysconfd_directory="/var/backups/xivo-sysconfd"
		if [ -d $old_sysconfd_directory ]; then
			rsync -av $old_sysconfd_directory/ $new_sysconfd_directory/ > /dev/null
			rm -rf $old_sysconfd_directory/*
		fi

		if [ -d /etc/pf-xivo/custom-templates ]; then
			rsync -av /etc/pf-xivo/custom-templates /etc/xivo/
			rm -rf /etc/pf-xivo/custom-templates
		fi
	;;
	abort-upgrade)
	;;

	*)
		echo "postinst called with unknown argument \`$1'" >&2
		exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

# Has to be after the DEBHELPER tag
sed -i 's#/etc/pf-xivo#/etc/xivo#' /etc/xivo/sysconfd.conf

exit 0
